define(["lodash","app/core/utils/kbn","app/plugins/sdk"],function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=98)}([function(e,r){e.exports=t},function(t,e,r){"use strict";var n;r.d(e,"a",function(){return n}),function(t){t.TimeSeries="time_series",t.MetricsTable="metrics_table",t.CsvTable="csv_table",t.Heatmap="heatmap",t.FlameGraph="flamegraph"}(n||(n={}))},function(t,e,r){"use strict";r.d(e,"c",function(){return i}),r.d(e,"b",function(){return a}),r.d(e,"a",function(){return s}),r.d(e,"d",function(){return c});var n=r(0),o=r.n(n);function i(t,e,r){var n=r.value;r.value=function(){var t=this;return this.inflightCalls||(this.inflightCalls={}),this.inflightCalls[e]?this.inflightCalls[e]:(this.inflightCalls[e]=n.apply(this,arguments),this.inflightCalls[e].then(function(r){return t.inflightCalls[e]=null,r},function(r){throw t.inflightCalls[e]=null,r}))}}function a(t){return!(t&&o.a.isString(t)&&t.trim().length>0)}function s(t){var e={};return t.variables?(t.variables.forEach(function(t){var r=t.current.value;("$__all"===r||o.a.isEqual(r,["$__all"]))&&(r=null===t.allValue?t.options.slice(1).map(function(t){return t.value}):t.allValue),e[t.name]={text:t.current.text,value:r}}),e):{}}function c(t,e){for(var r=t.split(".").map(function(t){return parseInt(t,10)}),n=e.split(".").map(function(t){return parseInt(t,10)}),o=Math.min(r.length,n.length),i=0;i<o;i++){if(r[i]>n[i])return 1;if(r[i]<n[i])return-1}return r.length===n.length?0:r.length<n.length?-1:1}},,function(t,e,r){(function(e){var r="object",n=function(t){return t&&t.Math==Math&&t};t.exports=n(typeof globalThis==r&&globalThis)||n(typeof window==r&&window)||n(typeof self==r&&self)||n(typeof e==r&&e)||Function("return this")()}).call(this,r(55))},function(t,e,r){"use strict";r.d(e,"b",function(){return p}),r.d(e,"c",function(){return h}),r.d(e,"a",function(){return d}),r.d(e,"d",function(){return v});var n,o=r(0),i=r.n(o),a=r(2),s=(r(43),n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},u=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},l=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},f=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},p=function(t){function e(r,n){var o=this,i=1!==r.length?"s":"";return n||(n="Cannot find metric"+i+" "+r.join(", ")+". Please check if the PMDA is enabled."),(o=t.call(this,n)||this).metrics=r,Object.setPrototypeOf(o,e.prototype),o}return s(e,t),e}(Error),h=function(t){function e(r,n){var o=this,i=1!==r.length?"s":"";return n||(n="Insufficient permissions to store metric"+i+" "+r.join(", ")+"."),(o=t.call(this,n)||this).metrics=r,Object.setPrototypeOf(o,e.prototype),o}return s(e,t),e}(Error),d=function(){function t(t,e,r){this.datasourceRequest=t,this.url=e,this.container=r,this.isPmwebd=!1,this.isPmproxy=!0,this.d=""}return t.prototype.newInstance=function(){return new t(this.datasourceRequest,this.url,this.container)},t.prototype.createContext=function(){return u(this,void 0,void 0,function(){var t;return l(this,function(e){switch(e.label){case 0:return[4,this.datasourceRequest({url:this.url+"/pmapi/context",params:{hostspec:"127.0.0.1",polltimeout:30}})];case 1:return t=e.sent(),this.context=t.data.context,t.data.source?(this.isPmproxy=!0,this.isPmwebd=!1,this.d=""):(this.isPmwebd=!0,this.isPmproxy=!1,this.d="_"),Object(a.b)(this.container)?[3,3]:[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"store",params:{name:"pmcd.client.container",value:this.container}})];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.ensureContext=function(t,e,r){var n=r.value,o=function(t){return u(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return this.context?[3,2]:[4,this.createContext()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,9]),[4,n.apply(this,t)];case 3:return[2,r.sent()];case 4:return e=r.sent(),this.isPmproxy&&i.a.has(e,"data.message")&&e.data.message.includes("unknown context identifier")||this.isPmwebd&&i.a.isString(e.data)&&e.data.includes("12376")?(console.debug("context expired, creating new context..."),[4,this.createContext()]):[3,7];case 5:return r.sent(),[4,n.apply(this,t)];case 6:return[2,r.sent()];case 7:throw e;case 8:return[3,9];case 9:return[2]}})})};r.value=function(){return o.call(this,arguments)}},t.prototype.metric=function(t){return u(this,void 0,void 0,function(){var e,r=this;return l(this,function(n){switch(n.label){case 0:if(!this.isPmproxy)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"metric",params:{names:t.join(",")}})];case 2:return[2,n.sent().data];case 3:if(e=n.sent(),i.a.has(e,"data.message")&&e.data.message.includes("Unknown metric name"))return[2,{metrics:[]}];throw e;case 4:return[3,7];case 5:return[4,Promise.all(t.map(function(t){return r.datasourceRequest({url:r.url+"/pmapi/"+r.context+"/"+r.d+"metric",params:{prefix:t}})}))];case 6:return[2,{metrics:n.sent().flatMap(function(t){var e=t.data.metrics;return e.length>0&&(e[0].pmid=e[0].pmid.toString(),e[0].labels={}),e})}];case 7:return[2]}})})},t.prototype.indom=function(t){return u(this,void 0,void 0,function(){var e,r,n,o,i,a;return l(this,function(s){switch(s.label){case 0:return[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"indom",params:{name:t}})];case 1:if(e=s.sent(),r=e.data,this.isPmwebd)try{for(n=f(r.instances),o=n.next();!o.done;o=n.next())o.value.labels={}}catch(t){i={error:t}}finally{try{o&&!o.done&&(a=n.return)&&a.call(n)}finally{if(i)throw i.error}}return[2,r]}})})},t.prototype.fetch=function(t){return u(this,void 0,void 0,function(){var e,r,n,o,a,s,c,u,p,h,d,v,m;return l(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"fetch",params:{names:t.join(",")}})];case 1:return r=l.sent(),e=r.data,[3,3];case 2:if(n=l.sent(),!(this.isPmwebd&&i.a.isString(n.data)&&n.data.includes("-12443")))throw n;return e={timestamp:{s:0,us:0},values:[]},[3,3];case 3:if(this.isPmwebd){e.timestamp=e.timestamp.s+e.timestamp.us/1e6;try{for(o=f(e.values),a=o.next();!a.done;a=o.next()){(s=a.value).pmid=s.pmid.toString();try{for(v=void 0,c=f(s.instances),u=c.next();!u.done;u=c.next())-1===(p=u.value).instance&&(p.instance=null)}catch(t){v={error:t}}finally{try{u&&!u.done&&(m=c.return)&&m.call(c)}finally{if(v)throw v.error}}}}catch(t){h={error:t}}finally{try{a&&!a.done&&(d=o.return)&&d.call(o)}finally{if(h)throw h.error}}}return[2,e]}})})},t.prototype.store=function(t,e){return u(this,void 0,void 0,function(){var r;return l(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"store",params:{name:t,value:e}})];case 1:return[2,n.sent().data];case 2:if(r=n.sent(),this.isPmproxy&&i.a.has(r,"data.message")&&r.data.message.includes("failed to lookup metric")||this.isPmwebd&&i.a.isString(r.data)&&r.data.includes("-12357"))throw new p([t]);if(this.isPmproxy&&i.a.has(r,"data.message")&&r.data.message.includes("No permission to perform requested operation")||this.isPmwebd&&i.a.isString(r.data)&&r.data.includes("-12387"))throw new h([t]);if(this.isPmproxy&&i.a.has(r,"data.message")&&r.data.message.includes("Bad input")||this.isPmwebd&&i.a.isString(r.data)&&r.data.includes("-12400"))return[2,{success:!1}];throw r;case 3:return[2]}})})},t.prototype.storeBeacon=function(t,e){return navigator.sendBeacon(this.url+"/pmapi/"+this.context+"/"+this.d+"store?name="+t,e)},t.prototype.children=function(t){return u(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return this.isPmproxy?[4,this.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"children",params:{prefix:t}})]:[3,2];case 1:return[2,e.sent().data];case 2:return[2,{nonleaf:[],leaf:[]}]}})})},c([a.c],t.prototype,"createContext",null),c([t.ensureContext],t.prototype,"metric",null),c([t.ensureContext],t.prototype,"indom",null),c([t.ensureContext],t.prototype,"fetch",null),c([t.ensureContext],t.prototype,"store",null),c([t.ensureContext],t.prototype,"storeBeacon",null),c([t.ensureContext],t.prototype,"children",null),t}(),v=function(){function t(t){this.context=t,this.metricMetadataCache={},this.instanceCache={},this.childrenCache={}}return t.prototype.getMetricMetadatas=function(t){return u(this,void 0,void 0,function(){var e,r,n,o,a,s,c;return l(this,function(u){switch(u.label){case 0:return(e=i.a.difference(t,Object.keys(this.metricMetadataCache))).length>0?[4,this.context.metric(e)]:[3,2];case 1:r=u.sent();try{for(n=f(r.metrics),o=n.next();!o.done;o=n.next())a=o.value,this.metricMetadataCache[a.name]=a}catch(t){s={error:t}}finally{try{o&&!o.done&&(c=n.return)&&c.call(n)}finally{if(s)throw s.error}}u.label=2;case 2:return[2,i.a.pick(this.metricMetadataCache,t)]}})})},t.prototype.getMetricMetadata=function(t){return u(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return[4,this.getMetricMetadatas([t])];case 1:return[2,e.sent()[t]]}})})},t.prototype.getIndoms=function(t,e){return void 0===e&&(e=!1),u(this,void 0,void 0,function(){var r,n,o,i,a,s;return l(this,function(c){switch(c.label){case 0:return t in this.instanceCache&&!e?[3,2]:[4,this.context.indom(t)];case 1:r=c.sent(),this.instanceCache[t]={};try{for(n=f(r.instances),o=n.next();!o.done;o=n.next())i=o.value,this.instanceCache[t][i.instance]=i}catch(t){a={error:t}}finally{try{o&&!o.done&&(s=n.return)&&s.call(n)}finally{if(a)throw a.error}}c.label=2;case 2:return[2,this.instanceCache[t]||{}]}})})},t.prototype.getIndom=function(t,e,r){return void 0===r&&(r=!1),u(this,void 0,void 0,function(){return l(this,function(n){switch(n.label){case 0:return t in this.instanceCache&&e in this.instanceCache[t]||r?[3,2]:[4,this.getIndoms(t,!0)];case 1:n.sent(),n.label=2;case 2:return[2,(this.instanceCache[t]||{})[e]]}})})},t.prototype.getMetricValues=function(t){return u(this,void 0,void 0,function(){var e,r,n,o,a,s,c,u;return l(this,function(l){switch(l.label){case 0:return[4,this.context.fetch(t)];case 1:if(e=l.sent(),r=e.values.map(function(t){return t.name}),(n=i.a.difference(t,r)).length>0){console.debug("fetch didn't include result for "+n.join(", ")+", clearing it from metric metadata and indom cache");try{for(o=f(n),a=o.next();!a.done;a=o.next())s=a.value,delete this.metricMetadataCache[s],delete this.instanceCache[s]}catch(t){c={error:t}}finally{try{a&&!a.done&&(u=o.return)&&u.call(o)}finally{if(c)throw c.error}}}return[2,e]}})})},t.prototype.storeMetricValue=function(t,e){return u(this,void 0,void 0,function(){return l(this,function(r){switch(r.label){case 0:return[4,this.context.store(t,e)];case 1:return[2,r.sent()]}})})},t.prototype.storeBeacon=function(t,e){return this.context.storeBeacon(t,e)},t.prototype.getChildren=function(t){return u(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return t in this.childrenCache?[2,this.childrenCache[t]]:[4,this.context.children(t)];case 1:return e=r.sent(),this.childrenCache[t]=e,[2,this.childrenCache[t]]}})})},t.prototype.getLabels=function(t,e,r){return void 0===r&&(r=!1),u(this,void 0,void 0,function(){var n,o,i;return l(this,function(a){switch(a.label){case 0:return[4,this.getMetricMetadata(t)];case 1:return(n=a.sent())?(o=n.labels,e?[4,this.getIndom(t,e,r)]:[3,3]):[2,{}];case 2:(i=a.sent())&&Object.assign(o,i.labels),a.label=3;case 3:return[2,o]}})})},t}()},function(t,e,r){var n=r(7);t.exports=!n(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){var r={}.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)}},function(t,e,r){var n=r(6),o=r(15),i=r(23);t.exports=n?function(t,e,r){return o.f(t,e,i(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e,r){var n=r(8);t.exports=function(t){if(!n(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,r){var n=r(4),o=r(16),i=r(59),a=n["__core-js_shared__"]||o("__core-js_shared__",{});(t.exports=function(t,e){return a[t]||(a[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:i?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,e,r){var n=r(19),o=Math.min;t.exports=function(t){return t>0?o(n(t),9007199254740991):0}},function(t,e,r){var n=r(57),o=r(25);t.exports=function(t){return n(o(t))}},function(t,e,r){var n=r(6),o=r(27),i=r(11),a=r(26),s=Object.defineProperty;e.f=n?s:function(t,e,r){if(i(t),e=a(e,!0),i(r),o)try{return s(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},function(t,e,r){var n=r(4),o=r(10);t.exports=function(t,e){try{o(n,t,e)}catch(r){n[t]=e}return e}},function(t,e){t.exports={}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e){var r=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:r)(t)}},,function(t,r){t.exports=e},function(t,e,r){var n=r(6),o=r(56),i=r(23),a=r(14),s=r(26),c=r(9),u=r(27),l=Object.getOwnPropertyDescriptor;e.f=n?l:function(t,e){if(t=a(t),e=s(e,!0),u)try{return l(t,e)}catch(t){}if(c(t,e))return i(!o.f.call(t,e),t[e])}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,r){var n=r(8);t.exports=function(t,e){if(!n(t))return t;var r,o;if(e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;if("function"==typeof(r=t.valueOf)&&!n(o=r.call(t)))return o;if(!e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,r){var n=r(6),o=r(7),i=r(28);t.exports=!n&&!o(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},function(t,e,r){var n=r(4),o=r(8),i=n.document,a=o(i)&&o(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},function(t,e,r){var n=r(12);t.exports=n("native-function-to-string",Function.toString)},function(t,e,r){var n=r(12),o=r(31),i=n("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,e){var r=0,n=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++r+n).toString(36)}},function(t,e,r){var n=r(64),o=r(4),i=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?i(n[t])||i(o[t]):n[t]&&n[t][e]||o[t]&&o[t][e]}},function(t,e,r){var n=r(9),o=r(14),i=r(66).indexOf,a=r(17);t.exports=function(t,e){var r,s=o(t),c=0,u=[];for(r in s)!n(a,r)&&n(s,r)&&u.push(r);for(;e.length>c;)n(s,r=e[c++])&&(~i(u,r)||u.push(r));return u}},function(t,e,r){var n=r(24);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,r){var n=r(36);t.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,r){var n=r(4),o=r(12),i=r(31),a=r(70),s=n.Symbol,c=o("wks");t.exports=function(t){return c[t]||(c[t]=a&&s[t]||(a?s:i)("Symbol."+t))}},function(t,e,r){"use strict";var n=r(0),o=r.n(n),i=r(2),a=r(1),s=(r(43),function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)}),c=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},u=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},l=function(){function t(t){this.templateSrv=t}return t.prototype.getLabel=function(t,e,r,n,a,c){if(void 0===c&&(c={}),Object(i.b)(e.legendFormat))return r(n,a,c);c=o.a.mapValues(c,function(t){return{value:t}});var u=n.split("."),l=s({},t.scopedVars,c,{metric:{value:n},metric0:{value:u[u.length-1]}});return a&&""!==a.name&&(l.instance={value:a.name}),this.templateSrv.replace(e.legendFormat,l)},t.prototype.transformToTimeSeries=function(t,e,r,n){var o=this;return n.instances.map(function(i){return{target:o.getLabel(t,e,r,n.name,i,i.labels),datapoints:i.values}})},t.prototype.transformToHeatmap=function(t){return t.instances.map(function(t){var e=t.name,r=t.name.match(/^(.+?)\-(.+?)$/);return r&&(e=r[2]),{target:e,datapoints:t.values.map(function(t){return[t[0],1e3*Math.floor(t[1]/1e3)]})}})},t.prototype.parseCsvLine=function(t){var e,r,n,o,i,a,s,l;return c(this,function(c){switch(c.label){case 0:e="",r="",c.label=1;case 1:c.trys.push([1,10,11,12]),n=u(t),o=n.next(),c.label=2;case 2:return o.done?[3,9]:(i=o.value,0!==e.length?[3,7]:'"'!==i&&"'"!==i?[3,3]:(e=i,[3,6]));case 3:return","!==i?[3,5]:[4,r];case 4:return c.sent(),r="",[3,6];case 5:r+=i,c.label=6;case 6:return[3,8];case 7:i===e?e="":r+=i,c.label=8;case 8:return o=n.next(),[3,2];case 9:return[3,12];case 10:return a=c.sent(),s={error:a},[3,12];case 11:try{o&&!o.done&&(l=n.return)&&l.call(n)}finally{if(s)throw s.error}return[7];case 12:return r.length>0?[4,r]:[3,14];case 13:c.sent(),c.label=14;case 14:return[2]}})},t.prototype.transformCsvToTable=function(t){var e,r,n={columns:[],rows:[],type:"table"},i="";if(1===t.length&&1===t[0].metrics.length&&1===t[0].metrics[0].instances.length&&t[0].metrics[0].instances[0].values.length>0){var a=t[0].metrics[0].instances[0],s=a.values[a.values.length-1][0];o.a.isString(s)&&s.includes(",")&&(i=s)}var c=i.split("\n");try{for(var l=u(c),f=l.next();!f.done;f=l.next()){var p=f.value;if(0!==(p=p.trim()).length)if(0===n.columns.length){var h=Array.from(this.parseCsvLine(p));n.columns=h.map(function(t){return{text:t}})}else{var d=Array.from(this.parseCsvLine(p));n.rows.push(d)}}}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return n},t.prototype.transformMetricsToTable=function(t,e,r){var n,i,a=this,s={columns:[],rows:[],type:"table"};s.columns=e.flatMap(function(e){return e.metrics.map(function(n){return{text:a.getLabel(t,e.target,r,n.name)}})}),s.columns.unshift({text:"instance"});var c=o.a.uniq(e.flatMap(function(t){return t.metrics.flatMap(function(t){return t.instances.map(function(t){return t.name})})})),l=function(t){var r,n,o,i,a=[t];try{for(var c=(r=void 0,u(e)),l=c.next();!l.done;l=c.next()){var f=l.value;try{for(var p=(o=void 0,u(f.metrics)),h=p.next();!h.done;h=p.next()){var d=h.value.instances.find(function(e){return e.name===t});d&&d.values.length>0?a.push(d.values[d.values.length-1][0]):a.push("")}}catch(t){o={error:t}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(o)throw o.error}}}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}s.rows.push(a)};try{for(var f=u(c),p=f.next();!p.done;p=f.next()){l(p.value)}}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}return s},t.prototype.transformToFlameGraph=function(t){return t.instances.map(function(t){return{target:t.name,datapoints:t.values}})},t.prototype.transform=function(t,e,r){var n=this,o=e[0].target.format;if(o===a.a.TimeSeries)return e.flatMap(function(e){return e.metrics.flatMap(function(o){return n.transformToTimeSeries(t,e.target,r,o)})});if(o===a.a.Heatmap)return e.flatMap(function(t){return t.metrics.flatMap(function(t){return n.transformToHeatmap(t)})});if(o===a.a.MetricsTable)return[this.transformMetricsToTable(t,e,r)];if(o===a.a.CsvTable)return[this.transformCsvToTable(e)];if(o===a.a.FlameGraph)return e.flatMap(function(t){return t.metrics.flatMap(function(t){return n.transformToFlameGraph(t)})});throw{message:"Invalid target format '"+o+"'."}},t}();e.a=l},function(t,e,r){"use strict";r.d(e,"a",function(){return a});var n=r(0),o=r.n(n),i=r(1),a=function(){function t(){}return t.applyTransformations=function(e,r,n,a){var s=[];if("counter"===r){var c=e===i.a.FlameGraph;s.push(t.counter(c)),n in this.PCP_UNITS&&s.push(t.divideBy(this.PCP_UNITS[n]))}var u=o.a.cloneDeep(a);return u.sort(function(t,e){return t[1]-e[1]}),s.reduce(function(t,e){return e(t)},u)},t.counter=function(t){return void 0===t&&(t=!1),function(e){if(0===e.length)return e;for(var r=e[0],n=1;n<e.length;){var o=e[n].slice();if(o[0]>=r[0]){var i=(o[1]-r[1])/1e3;e[n][0]=t?Math.ceil((o[0]-r[0])/i):(o[0]-r[0])/i,n++}else e.splice(n,1);r=o}return e.shift(),e}},t.divideBy=function(t){return function(e){return e.forEach(function(e){e[0]/=t}),e}},t.PCP_UNITS={nanosec:1e9,microsec:1e6,millisec:1e3},t}()},function(t,e,r){"use strict";r.d(e,"a",function(){return i});var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),i=function(t){function e(r){var n=this,o="Network error";return r.err?o="Network error: Could not connect to "+r.err.config.url+", please check the datasource and pmproxy settings":r.statusText&&(o="HTTP Error "+r.status+": "+r.statusText+", please check the datasource and pmproxy settings"),(n=t.call(this,o)||this).data=r.data,Object.setPrototypeOf(n,e.prototype),n}return o(e,t),e}(Error)},function(t,e,r){"use strict";r.d(e,"a",function(){return u});var n,o=r(0),i=r.n(o),a=r(42),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),c=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},u=function(t){function e(e,r,n){void 0===n&&(n=1e3);var o=t.call(this,e,r)||this;return o.typingDebounceTime=n,o.stopTypingDebounced=i.a.debounce(o.stopTyping,o.typingDebounceTime),o}return s(e,t),e.prototype.stopTyping=function(){delete this.target.isTyping},e.prototype.startTyping=function(){this.target.isTyping=!0,this.stopTypingDebounced()},e.prototype.targetChanged=function(){this.stopTyping(),this.panelCtrl.refresh()},e.prototype.tryRemoveTextCompleter=function(t){var e,r;if(!ace)return!1;var n=ace.acequire("ace/ext/language_tools").textCompleter;if(!n)return!1;var o=!1;try{for(var i=c(Array.from(document.querySelectorAll("code-editor[data-mode="+t+"]"))),a=i.next();!a.done;a=i.next()){var s=a.value,u=Array.from(s.env.editor.completers),l=u.indexOf(n);l>=0&&(u.splice(l,1),s.env.editor.completers=u),o=!0}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return o},e.prototype.removeTextCompleter=function(t){this.tryRemoveTextCompleter(t)||setTimeout(this.tryRemoveTextCompleter.bind(this,t),2e3)},e}(a.QueryCtrl)},function(t,e){t.exports=r},function(t,e,r){t.exports=r(53)},function(t,e,r){var n=r(4),o=r(22).f,i=r(10),a=r(58),s=r(16),c=r(62),u=r(69);t.exports=function(t,e){var r,l,f,p,h,d=t.target,v=t.global,m=t.stat;if(r=v?n:m?n[d]||s(d,{}):(n[d]||{}).prototype)for(l in e){if(p=e[l],f=t.noTargetGet?(h=o(r,l))&&h.value:r[l],!u(v?l:d+(m?".":"#")+l,t.forced)&&void 0!==f){if(typeof p==typeof f)continue;c(p,f)}(t.sham||f&&f.sham)&&i(p,"sham",!0),a(r,l,p,t)}}},function(t,e,r){"use strict";var n=r(34),o=r(13),i=r(35),a=function(t,e,r,s,c,u,l,f){for(var p,h=c,d=0,v=!!l&&i(l,f,3);d<s;){if(d in r){if(p=v?v(r[d],d,e):r[d],u>0&&n(p))h=a(t,e,p,o(p.length),h,u-1)-1;else{if(h>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[h]=p}h++}d++}return h};t.exports=a},function(t,e,r){var n=r(25);t.exports=function(t){return Object(n(t))}},function(t,e,r){var n=r(8),o=r(34),i=r(37)("species");t.exports=function(t,e){var r;return o(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!o(r.prototype)?n(r)&&null===(r=r[i])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===e?0:e)}},function(t,e,r){var n=r(37),o=r(72),i=r(10),a=n("unscopables"),s=Array.prototype;null==s[a]&&i(s,a,o(null)),t.exports=function(t){s[a][t]=!0}},function(t,e,r){var n=r(4),o=r(35),i=Function.call;t.exports=function(t,e,r){return o(i,n[t].prototype[e],r)}},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var o=(a=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[r].concat(i).concat([o]).join("\n")}var a;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(n[i]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),e.push(a))}},e}},function(t,e,r){var n,o,i={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),s=function(t){var e={};return function(t,r){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,u=0,l=[],f=r(52);function p(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=i[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(b(n.parts[a],e))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(b(n.parts[a],e));i[n.id]={id:n.id,refs:1,parts:s}}}}function h(t,e){for(var r=[],n={},o=0;o<t.length;o++){var i=t[o],a=e.base?i[0]+e.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(s):r.push(n[a]={id:a,parts:[s]})}return r}function d(t,e){var r=s(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=l[l.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),l.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=s(t.insertAt.before,r);r.insertBefore(e,o)}}function v(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=l.indexOf(t);e>=0&&l.splice(e,1)}function m(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return y(e,t.attrs),d(t,e),e}function y(t,e){Object.keys(e).forEach(function(r){t.setAttribute(r,e[r])})}function b(t,e){var r,n,o,i;if(e.transform&&t.css){if(!(i=e.transform(t.css)))return function(){};t.css=i}if(e.singleton){var a=u++;r=c||(c=m(e)),n=x.bind(null,r,a,!1),o=x.bind(null,r,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),d(t,e),e}(e),n=function(t,e,r){var n=r.css,o=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(n=f(n));o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([n],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,r,e),o=function(){v(r),r.href&&URL.revokeObjectURL(r.href)}):(r=m(e),n=function(t,e){var r=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}.bind(null,r),o=function(){v(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=h(t,e);return p(r,e),function(t){for(var n=[],o=0;o<r.length;o++){var a=r[o];(s=i[a.id]).refs--,n.push(s)}t&&p(h(t,e),e);for(o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete i[s.id]}}}};var g,w=(g=[],function(t,e){return g[t]=e,g.filter(Boolean).join("\n")});function x(t,e,r,n){var o=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=w(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var o,i=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")})}},function(t,e,r){r(54),r(71);var n=r(49);t.exports=n("Array","flatMap")},function(t,e,r){"use strict";var n=r(44),o=r(45),i=r(46),a=r(13),s=r(36),c=r(47);n({target:"Array",proto:!0},{flatMap:function(t){var e,r=i(this),n=a(r.length);return s(t),(e=c(r,0)).length=o(e,r,r,n,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!n.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:n},function(t,e,r){var n=r(7),o=r(24),i="".split;t.exports=n(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==o(t)?i.call(t,""):Object(t)}:Object},function(t,e,r){var n=r(4),o=r(12),i=r(10),a=r(9),s=r(16),c=r(29),u=r(60),l=u.get,f=u.enforce,p=String(c).split("toString");o("inspectSource",function(t){return c.call(t)}),(t.exports=function(t,e,r,o){var c=!!o&&!!o.unsafe,u=!!o&&!!o.enumerable,l=!!o&&!!o.noTargetGet;"function"==typeof r&&("string"!=typeof e||a(r,"name")||i(r,"name",e),f(r).source=p.join("string"==typeof e?e:"")),t!==n?(c?!l&&t[e]&&(u=!0):delete t[e],u?t[e]=r:i(t,e,r)):u?t[e]=r:s(e,r)})(Function.prototype,"toString",function(){return"function"==typeof this&&l(this).source||c.call(this)})},function(t,e){t.exports=!1},function(t,e,r){var n,o,i,a=r(61),s=r(4),c=r(8),u=r(10),l=r(9),f=r(30),p=r(17),h=s.WeakMap;if(a){var d=new h,v=d.get,m=d.has,y=d.set;n=function(t,e){return y.call(d,t,e),e},o=function(t){return v.call(d,t)||{}},i=function(t){return m.call(d,t)}}else{var b=f("state");p[b]=!0,n=function(t,e){return u(t,b,e),e},o=function(t){return l(t,b)?t[b]:{}},i=function(t){return l(t,b)}}t.exports={set:n,get:o,has:i,enforce:function(t){return i(t)?o(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!c(e)||(r=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}}},function(t,e,r){var n=r(4),o=r(29),i=n.WeakMap;t.exports="function"==typeof i&&/native code/.test(o.call(i))},function(t,e,r){var n=r(9),o=r(63),i=r(22),a=r(15);t.exports=function(t,e){for(var r=o(e),s=a.f,c=i.f,u=0;u<r.length;u++){var l=r[u];n(t,l)||s(t,l,c(e,l))}}},function(t,e,r){var n=r(32),o=r(65),i=r(68),a=r(11);t.exports=n("Reflect","ownKeys")||function(t){var e=o.f(a(t)),r=i.f;return r?e.concat(r(t)):e}},function(t,e,r){t.exports=r(4)},function(t,e,r){var n=r(33),o=r(18).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,o)}},function(t,e,r){var n=r(14),o=r(13),i=r(67),a=function(t){return function(e,r,a){var s,c=n(e),u=o(c.length),l=i(a,u);if(t&&r!=r){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((t||l in c)&&c[l]===r)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e,r){var n=r(19),o=Math.max,i=Math.min;t.exports=function(t,e){var r=n(t);return r<0?o(r+e,0):i(r,e)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,r){var n=r(7),o=/#|\.prototype\./,i=function(t,e){var r=s[a(t)];return r==u||r!=c&&("function"==typeof e?n(e):!!e)},a=i.normalize=function(t){return String(t).replace(o,".").toLowerCase()},s=i.data={},c=i.NATIVE="N",u=i.POLYFILL="P";t.exports=i},function(t,e,r){var n=r(7);t.exports=!!Object.getOwnPropertySymbols&&!n(function(){return!String(Symbol())})},function(t,e,r){r(48)("flatMap")},function(t,e,r){var n=r(11),o=r(73),i=r(18),a=r(17),s=r(75),c=r(28),u=r(30)("IE_PROTO"),l=function(){},f=function(){var t,e=c("iframe"),r=i.length;for(e.style.display="none",s.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),f=t.F;r--;)delete f.prototype[i[r]];return f()};t.exports=Object.create||function(t,e){var r;return null!==t?(l.prototype=n(t),r=new l,l.prototype=null,r[u]=t):r=f(),void 0===e?r:o(r,e)},a[u]=!0},function(t,e,r){var n=r(6),o=r(15),i=r(11),a=r(74);t.exports=n?Object.defineProperties:function(t,e){i(t);for(var r,n=a(e),s=n.length,c=0;s>c;)o.f(t,r=n[c++],e[r]);return t}},function(t,e,r){var n=r(33),o=r(18);t.exports=Object.keys||function(t){return n(t,o)}},function(t,e,r){var n=r(32);t.exports=n("document","documentElement")},function(t,e,r){"use strict";var n=r(0),o=r.n(n),i=r(21),a=r.n(i),s=r(5),c=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},u=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},l=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},f=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},p=function(){function t(t,e){this.pmapiSrv=t,this.localHistoryAgeMs=e,this.store={}}return t.prototype.ingestMetric=function(t,e,r){return c(this,void 0,void 0,function(){var n,o,i,a,s,c,f,p,h,d,v,m,y,b,g;return u(this,function(u){switch(u.label){case 0:n=!1,u.label=1;case 1:u.trys.push([1,11,12,13]),o=l(e.instances),i=o.next(),u.label=2;case 2:return i.done?[3,10]:(a=i.value,s=a.instance,(c=t.get(s))?(c.values.push([a.value,r]),[3,9]):[3,3]);case 3:return f="",null===s?[3,7]:[4,this.pmapiSrv.getIndom(e.name,s,!0)];case 4:return(p=u.sent())||n?[3,6]:[4,this.pmapiSrv.getIndom(e.name,s,!1)];case 5:p=u.sent(),n=!0,u.label=6;case 6:p&&(f=p.name),u.label=7;case 7:return d=(h=t).set,v=[s],m={id:s,name:f,values:[[a.value,r]]},[4,this.pmapiSrv.getLabels(e.name,s,n)];case 8:d.apply(h,v.concat([(m.labels=u.sent(),m)])),u.label=9;case 9:return i=o.next(),[3,2];case 10:return[3,13];case 11:return y=u.sent(),b={error:y},[3,13];case 12:try{i&&!i.done&&(g=o.return)&&g.call(o)}finally{if(b)throw b.error}return[7];case 13:return[2]}})})},t.prototype.ingest=function(t){return c(this,void 0,void 0,function(){var e,r,n,o,i,a,s;return u(this,function(c){switch(c.label){case 0:e=1e3*t.timestamp,c.label=1;case 1:c.trys.push([1,6,7,8]),r=l(t.values),n=r.next(),c.label=2;case 2:return n.done?[3,5]:((o=n.value).name in this.store||(this.store[o.name]=new Map),[4,this.ingestMetric(this.store[o.name],o,e)]);case 3:c.sent(),c.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return i=c.sent(),a={error:i},[3,8];case 7:try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(a)throw a.error}return[7];case 8:return[2]}})})},t.prototype.queryMetric=function(t,e,r){var n,o;if(!(t in this.store))return[];var i=[];try{for(var a=l(this.store[t]),s=a.next();!s.done;s=a.next()){var c=f(s.value,2)[1],u=c.values.filter(function(t){return e<=t[1]&&t[1]<=r});u.length>0&&i.push({id:c.id,name:c.name,values:u,labels:c.labels})}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},t.prototype.queryMetrics=function(t,e,r,n){var o=this;return{target:t,metrics:e.map(function(t){return{name:t,instances:o.queryMetric(t,r,n)}})}},t.prototype.cleanup=function(){var t,e,r=(new Date).getTime()-this.localHistoryAgeMs;for(var n in this.store)try{for(var o=(t=void 0,l(this.store[n].values())),i=o.next();!i.done;i=o.next()){var a=i.value;a.values=a.values.filter(function(t){return t[1]>r})}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t}(),h=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},d=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},v=function(){function t(t,e){this.pmapiSrv=t,this.datastore=e,this.requestedMetrics=[],this.metricHooks={}}return t.prototype.poll=function(){return h(this,void 0,void 0,function(){var t,e,r,n,i,a;return d(this,function(s){switch(s.label){case 0:return 0===(t=this.requestedMetrics).length?[2]:[4,this.pmapiSrv.getMetricValues(t)];case 1:for(e=s.sent(),r=e.values.map(function(t){return t.name}),n=e.values.length-1;n>=0;n--)(i=e.values[n]).name in this.metricHooks&&(this.metricHooks[i.name](i)||e.values.splice(n,1));return[4,this.datastore.ingest(e)];case 2:return s.sent(),(a=o.a.difference(t,r)).length>0&&(console.debug("fetch didn't include result for "+a.join(", ")+", clearing it from requested metrics"),this.requestedMetrics=o.a.difference(this.requestedMetrics,a)),[2]}})})},t.prototype.ensurePolling=function(t,e){return h(this,void 0,void 0,function(){var r,n,i,a=this;return d(this,function(c){switch(c.label){case 0:return[4,this.pmapiSrv.getMetricMetadatas(t)];case 1:if(r=c.sent(),n=Object.keys(r),(i=o.a.difference(t,n)).length>0)throw new s.b(i);return this.requestedMetrics=o.a.union(this.requestedMetrics,n),e&&n.forEach(function(t){a.metricHooks[t]=e}),[2]}})})},t.prototype.removeMetricsFromPolling=function(t){this.requestedMetrics=o.a.difference(this.requestedMetrics,t),this.metricHooks=o.a.omit(this.metricHooks,t)},t}(),m=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},y=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},b=function(){function t(){this.endpoints={}}return t.prototype.generateId=function(t,e){return e||(e=""),t+"::"+e},t.prototype.find=function(t,e){var r=this.generateId(t,e);return this.endpoints[r]},t.prototype.create=function(t,e,r,n){return m(this,void 0,void 0,function(){var o,i,a,c,u,l;return y(this,function(f){switch(f.label){case 0:return o=this.generateId(e,r),i=new s.d(new s.a(t,e,r)),a=new p(i,n),c=new v(i,a),[4,i.getMetricValues(["pmcd.version"])];case 1:return u=f.sent(),l=u.values[0].instances[0].value,this.endpoints[o]={id:o,pcpVersion:l,pmapiSrv:i,datastore:a,pollSrv:c},[2,this.endpoints[o]]}})})},t.prototype.list=function(){return Object.values(this.endpoints)},t}(),g=r(38),w=r(2),x=r(39),S=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},k=function(){function t(t){this.inactivityTimeoutMs=t,this.targets={}}return t.prototype.cmpTargets=function(t,e){return t.expr===e.expr&&t.format===e.format&&t.endpoint===e.endpoint},t.prototype.refresh=function(t){var e,r;try{for(var n=S(t),o=n.next();!o.done;o=n.next()){var i=o.value,a=i.uid,s=this.targets[a];s?this.cmpTargets(s.target,i)?s.lastActive=(new Date).getTime():(this.onTargetUpdate(s.target,i),this.targets[a]={target:Object.assign({},i),lastActive:(new Date).getTime()}):this.targets[a]={target:Object.assign({},i),lastActive:(new Date).getTime()}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.existMatchingTarget=function(t,e){for(var r in this.targets)if(r!==t.uid){var n=!0;for(var o in e)if(this.targets[r][o]!==e[o]){n=!1;break}if(n)return!0}return!1},t.prototype.cleanup=function(){var t=(new Date).getTime()-this.inactivityTimeoutMs;for(var e in this.targets)this.targets[e].lastActive<=t&&(this.onTargetInactive(this.targets[e].target),delete this.targets[e])},t}(),C=r(40);r(78);r.d(e,"a",function(){return j});var T=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},M=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},O=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},P=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},j=function(){function t(t,e,r){this.instanceSettings=t,this.backendSrv=e,this.templateSrv=r,this.name=t.name,this.withCredentials=t.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof t.basicAuth&&t.basicAuth.length>0&&(this.headers.Authorization=t.basicAuth),this.pollIntervalMs=a.a.interval_to_ms(t.jsonData.pollInterval||"1s"),this.inactivityTimeoutMs=a.a.interval_to_ms(t.jsonData.inactivityTimeoutMs||"50s"),this.localHistoryAgeMs=a.a.interval_to_ms(t.jsonData.localHistoryAge||"10m"),this.endpointRegistry=new b,this.transformations=new g.a(this.templateSrv),this.dashboardObserver=new k(this.inactivityTimeoutMs),this.dashboardObserver.onTargetUpdate=this.onTargetUpdate.bind(this),this.dashboardObserver.onTargetInactive=this.onTargetInactive.bind(this),this.backgroundErrors=new Set,this.pollIntervalMs>0&&setInterval(this.doPollAll.bind(this),this.pollIntervalMs)}return t.prototype.doPollAll=function(){return T(this,void 0,void 0,function(){var t,e=this;return M(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all(this.endpointRegistry.list().map(function(t){return T(e,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return this.dashboardObserver.cleanup(),t.datastore.cleanup(),[4,t.pollSrv.poll()];case 1:return e.sent(),[2]}})})}))];case 1:return r.sent(),[2,!0];case 2:return t=r.sent(),this.backgroundErrors.add(t.message),[2,!1];case 3:return[2]}})})},t.prototype.configureEndpoint=function(t){},t.prototype.getOrCreateEndpoint=function(t,e){return T(this,void 0,void 0,function(){var r;return M(this,function(n){switch(n.label){case 0:return(r=this.endpointRegistry.find(t,e))?[3,2]:[4,this.endpointRegistry.create(this.doRequest.bind(this),t,e,this.localHistoryAgeMs)];case 1:r=n.sent(),this.configureEndpoint(r),n.label=2;case 2:return[2,r]}})})},t.prototype.doRequest=function(t){return T(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:t.withCredentials=this.withCredentials,t.headers=this.headers,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.backendSrv.datasourceRequest(t)];case 2:return[2,r.sent()];case 3:throw e=r.sent(),new C.a(e);case 4:return[2]}})})},t.prototype.testDatasource=function(){return T(this,void 0,void 0,function(){var t;return M(this,function(e){switch(e.label){case 0:if(Object(w.b)(this.instanceSettings.url))return[2,{status:"success",message:"To use this data source, please configure the URL in the query editor."}];t=new s.d(new s.a(this.doRequest.bind(this),this.instanceSettings.url,this.instanceSettings.jsonData.container)),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.getMetricValues(["pmcd.hostname"])];case 2:return e.sent(),[2,{status:"success",message:"Data source is working"}];case 3:return[2,{status:"success",message:e.sent().message+". To use this data source, please configure the URL in the query editor."}];case 4:return[2]}})})},t.prototype.metricFindQuery=function(t){return T(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:if(Object(w.b)(this.instanceSettings.url))throw new Error("Please specify a connection URL in the datasource settings.");return t=this.templateSrv.replace(t),[4,this.getOrCreateEndpoint(this.instanceSettings.url,this.instanceSettings.jsonData.container)];case 1:return[4,e.sent().pmapiSrv.getMetricValues([t])];case 2:return[2,e.sent().values[0].instances.map(function(t){return{text:t.value,value:t.value}})]}})})},t.prototype.getConnectionParams=function(t,e){var r,n;if(Object(w.b)(t.url)){if(Object(w.b)(this.instanceSettings.url))throw new Error("Please specify a connection URL in the datasource settings or in the query editor.");r=this.instanceSettings.url}else r=this.templateSrv.replace(t.url,e);return Object(w.b)(t.container)?Object(w.b)(this.instanceSettings.jsonData.container)||(n=this.instanceSettings.jsonData.container):n=this.templateSrv.replace(t.container,e),[r,n]},t.prototype.buildQueryTargets=function(t){return T(this,void 0,void 0,function(){var e,r,n,o,i,a,s,c,u,l,f,p,h;return M(this,function(d){switch(d.label){case 0:e=[],d.label=1;case 1:d.trys.push([1,6,7,8]),r=O(t.targets),n=r.next(),d.label=2;case 2:return n.done?[3,5]:(o=n.value).hide||Object(w.b)(o.expr)||o.isTyping?[3,4]:(i=P(this.getConnectionParams(o,t.scopedVars),2),a=i[0],s=i[1],u=(c=e).push,l={refId:o.refId,expr:this.templateSrv.replace(o.expr.trim(),t.scopedVars),format:o.format,legendFormat:o.legendFormat,minPcpVersion:o.minPcpVersion,uid:t.dashboardId+"/"+t.panelId+"/"+o.refId,url:a,container:s},[4,this.getOrCreateEndpoint(a,s)]);case 3:u.apply(c,[(l.endpoint=d.sent(),l)]),d.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return f=d.sent(),p={error:f},[3,8];case 7:try{n&&!n.done&&(h=r.return)&&h.call(r)}finally{if(p)throw p.error}return[7];case 8:return[2,e]}})})},t.prototype.applyTransformations=function(t,e){return T(this,void 0,void 0,function(){var r,n,o,i,a,s,c,u,l,f,p,h;return M(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,7]),r=O(e.metrics),n=r.next(),d.label=1;case 1:return n.done?[3,4]:(o=n.value,[4,t.getMetricMetadata(o.name)]);case 2:i=d.sent();try{for(p=void 0,a=O(o.instances),s=a.next();!s.done;s=a.next())(c=s.value).values=x.a.applyTransformations(e.target.format,i.sem,i.units,c.values)}catch(t){p={error:t}}finally{try{s&&!s.done&&(h=a.return)&&h.call(a)}finally{if(p)throw p.error}}d.label=3;case 3:return n=r.next(),[3,1];case 4:return[3,7];case 5:return u=d.sent(),l={error:u},[3,7];case 6:try{n&&!n.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.defaultLegendFormatter=function(t,e,r){return e&&null!==e.id?e.name:t},t.prototype.queryTargetsByEndpoint=function(t,e){return T(this,void 0,void 0,function(){var r=this;return M(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return r.handleTarget(t,e)}))];case 1:return[2,n.sent()]}})})},t.prototype.query=function(e){return T(this,void 0,void 0,function(){var r,n,i,a,s,c=this;return M(this,function(u){switch(u.label){case 0:if(this.backgroundErrors.size>0)throw r=Array.from(this.backgroundErrors).join("\n"),this.backgroundErrors.clear(),new Error(r);return[4,this.buildQueryTargets(e)];case 1:if(0===(n=u.sent()).length)return[2,{data:[]}];if(!o.a.every(n,["format",n[0].format]))throw new Error("Format must be the same for all queries of a panel.");return this.dashboardObserver.refresh(n),i=o.a.groupBy(n,function(t){return t.endpoint.id}),a=Object.values(i).map(function(t){return c.queryTargetsByEndpoint(e,t)}),[4,Promise.all(a)];case 2:return s=u.sent(),[2,{data:this.transformations.transform(e,s.flat(),t.defaultLegendFormatter)}]}})})},t}()},function(t){t.exports=JSON.parse('{"b":[{"name":"name","value":"name: ","doc":"script name (must contain only alphanumeric characters and start with a letter)"},{"name":"include","value":"include: ","doc":"include only the specified bpftrace variables (comma-separated list)\\n\\nexample: ```// include: @usecs,@bytes```"},{"name":"table-retain-lines","value":"table-retain-lines: ","doc":"retain only the specified number of lines, keeping the header line\\n\\nexample: ```// table-retain-lines: 10```"},{"name":"custom-output-block","value":"custom-output-block","doc":"script is using a custom output block\\n\\nexample: ```// custom-output-block\\ninterval:s:1 { print(@bytes); }```"}],"c":[{"name":"BEGIN"},{"name":"END"},{"name":"uprobe"},{"name":"uretprobe"},{"name":"usdt"},{"name":"profile"},{"name":"interval"},{"name":"watchpoint"}],"d":[{"name":"pid","doc":"Process ID (kernel tgid)"},{"name":"tid","doc":"Thread ID (kernel pid)"},{"name":"cgroup","doc":"Cgroup ID of the current process"},{"name":"uid","doc":"User ID"},{"name":"gid","doc":"Group ID"},{"name":"nsecs","doc":"Nanosecond timestamp"},{"name":"elapsed","doc":"Nanosecond timestamp since bpftrace initialization"},{"name":"cpu","doc":"Processor ID"},{"name":"comm","doc":"Process name"},{"name":"kstack","doc":"Kernel stack trace"},{"name":"ustack","doc":"User stack trace"},{"name":"argN","value":"arg0","doc":"Argument to the function being traced (`arg0`, `arg1`, etc.)"},{"name":"retval","doc":"Return value from function being traced"},{"name":"func","doc":"Name of the function currently being traced"},{"name":"probe","doc":"Full name of the probe"},{"name":"curtask","doc":"Current task_struct as a u64"},{"name":"rand","doc":"Random number of type u32"}],"a":[{"def":"hist(int n)","doc":"Produce a log2 histogram of values of `n`"},{"def":"lhist(int n, int min, int max, int step)","doc":"Produce a linear histogram of values of `n`"},{"def":"count()","doc":"Count the number of times this function is called"},{"def":"sum(int n)","doc":"Sum this value"},{"def":"min(int n)","doc":"Record the minimum value seen"},{"def":"max(int n)","doc":"Record the maximum value seen"},{"def":"avg(int n)","doc":"Average this value"},{"def":"stats(int n)","doc":"Return the count, average, and total for this value"},{"def":"delete(@x)","doc":"Delete the map element passed in as an argument"},{"def":"str(char *s [, int length])","doc":"Returns the string pointed to by `s`"},{"def":"printf(char *fmt, ...)","doc":"Print formatted to stdout"},{"def":"print(@x[, int top [, int div]])","doc":"Print a map, with optional top entry count and divisor"},{"def":"clear(@x)","doc":"Delete all key/values from a map"},{"def":"sym(void *p)","doc":"Resolve kernel address"},{"def":"usym(void *p)","doc":"Resolve user space address"},{"def":"ntop([int af, ]int|char[4|16] addr)","doc":"Resolve ip address"},{"def":"kaddr(char *name)","doc":"Resolve kernel symbol name"},{"def":"uaddr(char *name)","doc":"Resolve user space symbol name"},{"def":"reg(char *name)","doc":"Returns the value stored in the named register"},{"def":"join(char *arr[] [, char *delim])","doc":"Prints the string array"},{"def":"time(char *fmt)","doc":"Print the current time"},{"def":"cat(char *filename)","doc":"Print file content"},{"def":"system(char *fmt)","doc":"Execute shell command"},{"def":"exit()","doc":"Quit bpftrace"}]}')},function(t,e,r){t.exports=r(79)},function(t,e,r){r(80),r(81);var n=r(49);t.exports=n("Array","flat")},function(t,e,r){"use strict";var n=r(44),o=r(45),i=r(46),a=r(13),s=r(19),c=r(47);n({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=i(this),r=a(e.length),n=c(e,0);return n.length=o(n,e,e,r,0,void 0===t?1:s(t)),n}})},function(t,e,r){r(48)("flat")},,,,,,,,function(t,e,r){var n=r(90);"string"==typeof n&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};r(51)(n,o);n.locals&&(t.exports=n.locals)},function(t,e,r){(t.exports=r(50)(!0)).push([t.i,".ace_probe {\n    font-weight: bold;\n}\n","",{version:3,sources:["/home/vsts/work/1/s/src/datasources/bpftrace/css/query-editor.css"],names:[],mappings:"AAAA;IACI,kBAAkB;CACrB",file:"query-editor.css",sourcesContent:[".ace_probe {\n    font-weight: bold;\n}\n"],sourceRoot:""}])},function(t,e){ace.define("ace/snippets/bpftrace",["require","exports","module"],function(t,e,r){"use strict";e.snippets=[],e.scope="bpftrace"}),ace.define("ace/mode/bpftrace_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(t,e,r){"use strict";var n=t("../lib/oop"),o=t("./text_highlight_rules").TextHighlightRules,i=function(){var t=this.createKeywordMapper({keyword:"if|else|unroll","storage.type":"struct|union|enum","variable.language":"pid|tid|cgroup|uid|gid|nsecs|cpu|comm|kstack|stack|ustack|retval|func|probe|curtask|rand|ctx|username|args|elapsed|arg0|arg1|arg2|arg3|arg4|arg5|arg6|arg7|arg8|arg9","constant.language":"true|false","support.function":"printf|time|join|str|ksym|usym|kaddr|uaddr|reg|system|exit|cgroupid|kstack|ustack|ntop|cat|count|sum|avg|min|max|stats|hist|lhist|delete|print|clear|zero"},"identifier");this.$rules={start:[{token:"comment",regex:"//.*$"},{token:"comment",start:"/\\*",end:"\\*/"},{token:"keyword",regex:"#\\s*(?:include|import|pragma|line|define|undef)\\b"},{token:"text",regex:"<.*>"},{token:"keyword.control.probe",regex:"BEGIN|END|"+["(k|u)(ret)?probe","tracepoint","usdt","profile","interval","software","hardware","watchpoint"].map(t=>`${t}:[a-zA-Z0-9_\\-:./]*`).join("|")},{token:"string",regex:'".*?"'},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+(L|l|UL|ul|u|U|F|f|ll|LL|ull|ULL)?\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?(L|l|UL|ul|u|U|F|f|ll|LL|ull|ULL)?\\b"},{token:"variable.other",regex:"(@|\\$)[a-zA-Z_][a-zA-Z0-9_]*"},{token:t,regex:"[a-zA-Z_][a-zA-Z0-9_]*"},{token:"keyword.operator",regex:/--|\+\+|<<=|>>=|>>>=|<>|&&|\|\||\?:|[*%\/+\-&\^|~!<>=]=?/},{token:"punctuation.operator",regex:"\\?|\\:|\\,|\\;|\\."},{token:"paren.lparen",regex:"[[(]"},{token:"paren.rparen",regex:"[\\])]"},{token:"paren.lparen.brace",regex:"{"},{token:"paren.rparen.brace",regex:"}"},{token:"text",regex:"\\s+"}]},this.normalizeRules()};n.inherits(i,o),e.BPFtraceHighlightRules=i}),ace.define("ace/mode/bpftrace",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/bpftrace_highlight_rules"],function(t,e,r){"use strict";var n=t("../lib/oop"),o=t("./text").Mode,i=t("./bpftrace_highlight_rules").BPFtraceHighlightRules,a=function(){this.HighlightRules=i,this.$behaviour=this.$defaultBehaviour,this.completer={getCompletions:function(t,e,r,n,o){o(null,[])}}};n.inherits(a,o),function(){this.$id="ace/mode/bpftrace"}.call(a.prototype),e.Mode=a})},,,,,,,function(t,e,r){"use strict";r.r(e);var n,o,i=r(76),a=r(0),s=r.n(a),c=r(5);!function(t){t.Control="control",t.Histogram="histogram",t.Output="output",t.Stacks="stacks"}(n||(n={})),function(t){t.Stopped="stopped",t.Starting="starting",t.Started="started",t.Stopping="stopping",t.Error="error"}(o||(o={}));var u,l=r(1),f=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},p=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},h=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},d=function(){function t(t,e){this.pmapiSrv=t,this.pollSrv=e,this.scripts={},this.targetToScriptId={}}return t.prototype.getMetric=function(t,e){return"bpftrace.scripts."+(t.metadata.name||t.script_id)+".data."+(e=e.substring(1)||"root")},t.prototype.getVariablesForTargetFormat=function(t,e){if(e===l.a.TimeSeries)return Object.keys(t.variables);if(e===l.a.Heatmap){if(!(r=Object.entries(t.variables).find(function(t){var e=h(t,2);e[0];return e[1].metrictype===n.Histogram})))throw new Error("Cannot find any histogram in this BPFtrace script.");return[r[0]]}if(e===l.a.CsvTable){if(!(r=Object.entries(t.variables).find(function(t){var e=h(t,2);e[0];return e[1].metrictype===n.Output})))throw new Error("Please printf() a table in CSV format in the BPFtrace script.");return[r[0]]}if(e===l.a.FlameGraph){var r;if(!(r=Object.entries(t.variables).find(function(t){var e=h(t,2);e[0];return e[1].metrictype===n.Stacks})))throw new Error("Cannot find any sampled stacks in this BPFtrace script. Try: profile:hz:99 { @[kstack] = count(); }");return[r[0]]}throw new Error("Unsupported panel format.")},t.prototype.getMetrics=function(t,e){var r=this;return this.getVariablesForTargetFormat(t,e).map(function(e){return r.getMetric(t,e)})},t.prototype.storeControlMetric=function(t,e){return f(this,void 0,void 0,function(){var r,n,o;return p(this,function(i){switch(i.label){case 0:r=new c.d(this.pmapiSrv.context.newInstance()),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.storeMetricValue(t,e)];case 2:return i.sent(),[3,4];case 3:throw(n=i.sent())instanceof c.c?new Error("You don't have permission to register bpftrace scripts. Please check the datasource authentication settings and the bpftrace PMDA configuration (bpftrace.conf)."):n;case 4:return[4,r.getMetricValues([t])];case 5:return o=i.sent(),[2,JSON.parse(o.values[0].instances[0].value)]}})})},t.prototype.register=function(t){return f(this,void 0,void 0,function(){var e;return p(this,function(r){switch(r.label){case 0:return console.debug("registering script",t.split("\n")),[4,this.storeControlMetric("bpftrace.control.register",t)];case 1:if(e=r.sent(),console.debug("script register response",e),s.a.isEmpty(e))throw new Error("PMDA returned an empty response when registering this script.");return[2,e]}})})},t.prototype.deregister=function(t){return f(this,void 0,void 0,function(){var e,r,n,o=this;return p(this,function(i){switch(i.label){case 0:return(e=this.targetToScriptId[t])?(delete this.targetToScriptId[t],(r=this.scripts[e])?(delete this.scripts[e],console.debug("deregistering script",r),this.pollSrv.removeMetricsFromPolling(Object.keys(r.variables).map(function(t){return o.getMetric(r,t)})),[4,this.storeControlMetric("bpftrace.control.deregister",r.script_id)]):[2]):[2];case 1:return n=i.sent(),console.debug("script deregister response",n),[2]}})})},t.prototype.deregisterAllScripts=function(){var t=Object.values(this.targetToScriptId);this.pmapiSrv.storeBeacon("bpftrace.control.deregister",t.join(","))},t.prototype.syncScripts=function(t){if(t.instances.length>0){var e=JSON.parse(t.instances[0].value);this.scripts=s.a.keyBy(e,"script_id")}return!1},t.prototype.ensureActive=function(t,e){return f(this,void 0,void 0,function(){var r,n,i,a;return p(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.pollSrv.ensurePolling(["bpftrace.info.scripts_json"],this.syncScripts.bind(this))];case 1:return s.sent(),[3,3];case 2:throw(r=s.sent())instanceof c.b?new Error("Please install the bpftrace PMDA to use this datasource."):r;case 3:return n=this.targetToScriptId[t],(i=n?this.scripts[n]:null)?[3,5]:[4,this.register(e)];case 4:i=s.sent(),this.scripts[i.script_id]=i,this.targetToScriptId[t]=i.script_id,s.label=5;case 5:return i.state.status!==o.Stopped?[3,7]:[4,this.storeControlMetric("bpftrace.control.start",i.script_id)];case 6:a=s.sent(),console.debug("restarted script "+i.script_id+", response:",a),i.state.status=o.Starting,s.label=7;case 7:return[2,i]}})})},t}(),v=r(2),m=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),y=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},b=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},g=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},w=function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return window.addEventListener("unload",o.deregisterAllScripts.bind(o),!1),o}return e.$inject=["instanceSettings","backendSrv","templateSrv"],m(e,t),e.prototype.deregisterAllScripts=function(){var t,e;try{for(var r=g(this.endpointRegistry.list()),n=r.next();!n.done;n=r.next()){n.value.scriptRegistry.deregisterAllScripts()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.configureEndpoint=function(t){t.scriptRegistry=new d(t.pmapiSrv,t.pollSrv)},e.prototype.onTargetUpdate=function(t,e){return y(this,void 0,void 0,function(){return b(this,function(r){return t.endpoint===e.endpoint&&t.expr===e.expr||this.onTargetInactive(t),[2]})})},e.prototype.onTargetInactive=function(t){return y(this,void 0,void 0,function(){return b(this,function(e){return t.endpoint.scriptRegistry.deregister(t.uid),[2]})})},e.prototype.handleTarget=function(t,e){return y(this,void 0,void 0,function(){var r,n,i,a,s,c;return b(this,function(u){switch(u.label){case 0:if(r=e.endpoint,e.minPcpVersion&&Object(v.d)(e.minPcpVersion,r.pcpVersion)>0)throw new Error("This target requires PCP version "+e.minPcpVersion+", however PCP version "+r.pcpVersion+" is installed.");return[4,r.scriptRegistry.ensureActive(e.uid,e.expr)];case 1:if((n=u.sent()).state.status!==o.Started&&n.state.status!==o.Starting)throw new Error("BPFtrace error:\n\n"+n.state.error);return i=r.scriptRegistry.getMetrics(n,e.format),[4,r.pollSrv.ensurePolling(i)];case 2:return u.sent(),a=t.range.from.valueOf()-2*this.pollIntervalMs,s=t.range.to.valueOf()+this.pollIntervalMs,c=r.datastore.queryMetrics(e,i,a,s),[4,this.applyTransformations(r.pmapiSrv,c)];case 3:return u.sent(),[2,c]}})})},e}(i.a),x=r(41),S=r(77),k=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}c((n=n.apply(t,e||[])).next())})},C=function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},T=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},M=ace.acequire("ace/token_iterator").TokenIterator,O=function(){function t(t,e){this.datasource=t,this.target=e,this.identifierRegexps=[/[a-zA-Z0-9_\-:.]/],this.metadataCompletions=[],this.probeCompletions=[],this.builtinVariableCompletions=[],this.builtinFunctionCompletions=[],this.prepareBuiltinCompletions()}return t.prototype.getCompletions=function(t,e,r,n,o){this.findCompletions(t,e,r,n).then(function(t){o(null,t)},function(t){o(t,[])})},t.prototype.genDocHTML=function(t,e){return"<b>"+(t=s.a.escape(t))+"</b><hr />"+(e=(e=(e=s.a.escape(e)).replace(/```([^]+?)```/g,"<pre>$1</pre>")).replace(/`(.+?)`/g,"<code>$1</code>"))},t.prototype.prepareBuiltinCompletions=function(){var t=this;this.metadataCompletions=S.b.map(function(e){return{caption:e.name,value:e.value,meta:"metadata",score:0,docHTML:t.genDocHTML(e.name,e.doc)}}),this.probeCompletions=S.c.map(function(t){return{caption:t.name+":",value:t.name+":",meta:"probe",score:Number.MAX_VALUE}}),this.builtinVariableCompletions=S.d.map(function(e){return{caption:e.name,value:e.value||e.name,meta:"variable",score:0,docHTML:t.genDocHTML(e.name,e.doc)}}),this.builtinFunctionCompletions=S.a.map(function(e){var r=e.def.substring(0,e.def.indexOf("("));return{caption:r+"()",value:r,meta:"function",score:0,docHTML:t.genDocHTML(e.def,e.doc)}})},t.prototype.findProbeCompletions=function(){return k(this,void 0,void 0,function(){var e,r,n,o,i,a,s,c;return C(this,function(u){switch(u.label){case 0:return e=T(this.datasource.getConnectionParams(this.target,{}),2),r=e[0],n=e[1],[4,this.datasource.getOrCreateEndpoint(r,n)];case 1:return o=u.sent(),t.probeCache[o.id]?[3,3]:[4,o.pmapiSrv.getMetricValues(["bpftrace.info.tracepoints"])];case 2:for(i=u.sent(),a=i.values[0].instances[0].value.split(",").sort(function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())}),s=0,c=a.length;s<c;s++)a[s].startsWith("kprobe:")&&a.push("kretprobe:"+a[s].substring(a[s].indexOf(":")+1));t.probeCache[o.id]=a.map(function(t){return{caption:t,value:t,meta:"probe",score:Number.MAX_VALUE}}),u.label=3;case 3:return[2,this.probeCompletions.concat(t.probeCache[o.id])]}})})},t.prototype.findCompletions=function(t,e,r,n){return k(this,void 0,void 0,function(){var t,n,o,i;return C(this,function(a){switch(a.label){case 0:for(t=new M(e,r.row,r.column),n=0,o=0,i=t.getCurrentToken();i;i=t.stepBackward())"paren.lparen.brace"===i.type?n++:"paren.rparen.brace"===i.type?n--:0===n&&"keyword.operator"===i.type&&"/"===i.value&&(o=(o+1)%2);return"comment"!==e.getTokenAt(r.row,r.column).type?[3,1]:[2,this.metadataCompletions];case 1:return 0!==n||0!==o?[3,3]:[4,this.findProbeCompletions()];case 2:return[2,a.sent()];case 3:return 0===n&&1===o?[2,this.builtinVariableCompletions]:[2,this.builtinVariableCompletions.concat(this.builtinFunctionCompletions)];case 4:return[2]}})})},t.probeCache={},t}(),P=(r(89),r(91),function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()),j=function(t){function e(e,r){var n=t.call(this,e,r,3e3)||this;return n.formats=[],n.target.expr=n.target.expr||"",n.target.format=n.target.format||n.getDefaultFormat(),n.formats=[{text:"Time series",value:l.a.TimeSeries},{text:"Table (CSV)",value:l.a.CsvTable},{text:"Heatmap",value:l.a.Heatmap},{text:"Flame Graph",value:l.a.FlameGraph}],n}return e.$inject=["$scope","$injector"],P(e,t),e.prototype.getDefaultFormat=function(){return"table"===this.panelCtrl.panel.type?l.a.CsvTable:"heatmap"===this.panelCtrl.panel.type?l.a.Heatmap:"pcp-flamegraph-panel"===this.panelCtrl.panel.type?l.a.FlameGraph:l.a.TimeSeries},e.prototype.getCompleter=function(){return this.removeTextCompleter("bpftrace"),new O(this.datasource,this.target)},e.templateUrl="datasources/bpftrace/partials/query.editor.html",e}(x.a);r.d(e,"ConfigCtrl",function(){return _}),r.d(e,"AnnotationsQueryCtrl",function(){return A}),r.d(e,"Datasource",function(){return w}),r.d(e,"QueryCtrl",function(){return j});var _=function(){function t(){}return t.templateUrl="datasources/bpftrace/partials/config.html",t}(),A=function(){function t(){}return t.templateUrl="datasources/bpftrace/partials/annotations.editor.html",t}()}])});
//# sourceMappingURL=module.js.map